
source germany : db_slave {

        sql_query_range         = SELECT min(gridimage_id), max(gridimage_id) FROM gridimage_germany 
        sql_range_step          = 50000


sql_query = SELECT \
        gi.gridimage_id, \
        UNIX_TIMESTAMP(gi.submitted) AS submitted, \
        TO_DAYS(REPLACE(gi.imagetaken,'-00','-01')) AS takendays, \
        REPLACE(gi.imagetaken,'-','') AS takenday, \
        REPLACE(substring(gi.imagetaken,1,7),'-','') AS takenmonth, \
        substring(gi.imagetaken,1,4) AS takenyear, \
        CONCAT(substring(gi.imagetaken,1,3),'tt') AS decade, \
	coalesce(MONTHNAME(gi.imagetaken),'Unknown') AS monthname, \
        gi.user_id, CONCAT('user',gi.user_id) as user, \
        if(photographer_name!='',photographer_name,uploader_name) AS realname, \
        gi.title, gi.title2, \
        gi.comment, gi.comment2, \
        SUBSTRING(gi.grid_reference,1,LENGTH(gi.grid_reference)-4) AS myriad,\
        CONCAT(SUBSTRING(gi.grid_reference,1,LENGTH(gi.grid_reference)-3),SUBSTRING(gi.grid_reference,LENGTH(gi.grid_reference)-1,1)) AS hectad,\
        gi.imageclass, \
        concat_ws(',',reference_index,nateastings div 1000,natnorthings div 1000) AS grid_reference,\
        (gi.reference_index * 1000000000 + IF(gi.natgrlen+0 <= 3,(gi.nateastings DIV 100) * 100000 + (gi.natnorthings DIV 100),0)) AS scenti,\
        RADIANS(wgs84_lat) AS wgs84_lat,\
        RADIANS(wgs84_long) AS wgs84_long,\
	CONCAT('ftf',gi.ftf) AS ftf,\
        IF(gi.moderation_status='accepted','supplemental',gi.moderation_status) AS status,\
        (viewpoint_refindex * 1000000 + (viewpoint_northings DIV 1000) * 1000 + viewpoint_eastings DIV 1000) AS viewsquare,\
        IF(natnorthings>0 AND viewpoint_eastings>0,\
                pow(2,floor(log2(SQRT(\
                        pow(cast(nateastings as signed)-cast(viewpoint_eastings as signed),2)\
                        +pow(cast(natnorthings as signed)-cast(viewpoint_northings as signed),2)\
                ))))\
                ,'Unknown') AS distance,\
        IF(view_direction=-1,'Unknown',view_direction) AS direction,\
        IF(ABS(cast(width as signed)-cast(height as signed)) <= 60,'square',IF(width>height,IF(width>(height*2),'panorama','landscape'),'portrait')) AS format,\
        CRC32(gi.gridimage_id) AS sequence, \
        substring_index(substring_index(path,'_',-1),'.',1) AS hash, \
	concat( if(greatest(original_width,original_height) >= 3000,'3000 ',''), if(greatest(original_width,original_height) >= 1600,'1600 ',''), if(greatest(original_width,original_height) >= 1024,'1024 ',''), if(greatest(original_width,original_height) >= 800,'800 ',''), if(greatest(original_width,original_height) >= 640,'641 ','') ) AS larger, \
	greatest(original_width,original_height) as original \
FROM gridimage_germany gi \
WHERE gi.gridimage_id>=$start AND gi.gridimage_id<=$end

sql_attr_timestamp      = submitted
sql_attr_uint           = takendays
sql_field_string        = takenday
sql_field_string        = takenmonth
sql_field_string        = takenyear
sql_field_string        = decade
sql_field_string        = monthname
sql_attr_uint           = user_id
sql_field_string        = realname
sql_field_string        = title
sql_field_string        = title2
sql_field_string        = myriad
sql_field_string        = hectad
sql_field_string        = imageclass
sql_field_string        = grid_reference
sql_attr_uint           = scenti
sql_attr_float          = wgs84_lat
sql_attr_float          = wgs84_long
sql_field_string        = status
sql_attr_uint           = viewsquare
sql_field_string        = distance
sql_field_string        = direction
sql_field_string        = format
sql_attr_uint           = sequence
sql_field_string        = hash
sql_attr_uint           = original
}

index germany {
        source                  = germany
        path                    = /var/lib/manticore/data/germany

        min_word_len            = 1

        morphology              = stem_en
##	morphology_skip_fields  = takenday,takenmonth,takenyear,decade,monthname,user,realname,myriad,hectad,imageclass,grid_reference,ftf,contexts,types,buckets,wikis,status,distance,direction,format,place,county,country,hash,larger,landcover
##		##http://docs.manticoresearch.com/latest/html/conf_options_reference/index_configuration_options.html?highlight=morphology_skip_fields
##		## actully this means that ONLY title,comment, and tags/groups/terms/snippets/imageclass still have morphology!

##	#these are both needed with morphology_skip_fields to function!
##	expand_keywords 	= 1 
        index_exact_words       = 1

        min_prefix_len = 2
        prefix_fields = imageclass,realname,takenday,takenmonth,takenyear

        dict=crc
}

